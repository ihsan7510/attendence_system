{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Mark Attendance</h5>
            </div>
            <div class="card-body">
                <form method="GET" action="{{ url_for('mark_attendance') }}" class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label for="class_id" class="form-label">Class</label>
                        <select class="form-select" id="class_id" name="class_id" required>
                            <option value="">Select Class...</option>
                            {% for class in classes %}
                            <option value="{{ class.id }}" {% if selected_class|int==class.id %}selected{% endif %}>{{
                                class.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="subject_id" class="form-label">Subject</label>
                        <select class="form-select" id="subject_id" name="subject_id" required>
                            <option value="">Select Subject...</option>
                            {% for subject in subjects %}
                            <option value="{{ subject.id }}" {% if selected_subject|int==subject.id %}selected{% endif
                                %}>{{ subject.name }} ({{ subject.class_val.name }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="date" name="date"
                            value="{{ selected_date if selected_date else '' }}" required>
                    </div>
                    <div class="col-md-1">
                        <button type="submit" class="btn btn-primary w-100">Load</button>
                    </div>
                </form>
            </div>
        </div>

        {% if students %}
        <div class="card shadow">
            <div class="card-header bg-light">
                <h5 class="mb-0">Student List</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('mark_attendance') }}">
                    <input type="hidden" name="class_id" value="{{ selected_class }}">
                    <input type="hidden" name="subject_id" value="{{ selected_subject }}">
                    <input type="hidden" name="date" value="{{ selected_date }}">

                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Roll No</th>
                                <th>Name</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ student.roll_number }}</td>
                                <td>{{ student.name }}</td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <input type="radio" class="btn-check" name="status_{{ student.id }}"
                                            id="present_{{ student.id }}" value="Present" checked>
                                        <label class="btn btn-outline-success"
                                            for="present_{{ student.id }}">Present</label>

                                        <input type="radio" class="btn-check" name="status_{{ student.id }}"
                                            id="absent_{{ student.id }}" value="Absent">
                                        <label class="btn btn-outline-danger"
                                            for="absent_{{ student.id }}">Absent</label>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg">Submit Attendance</button>
                    </div>
                </form>
            </div>
        </div>
        {% elif already_marked %}
        <div class="alert alert-info text-center">
            Attendance for this class, subject, and date has already been recorded.
            <a href="{{ url_for('view_reports', class_id=selected_class, subject_id=selected_subject) }}"
                class="alert-link">View Report</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}